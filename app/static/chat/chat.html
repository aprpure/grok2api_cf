<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Grok2API - 在线聊天</title>
  <link rel="icon" href="/static/favicon/favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/geist@1.0.0/dist/fonts/geist-sans/style.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/geist@1.0.0/dist/fonts/geist-mono/style.css" rel="stylesheet">
  <link href="/static/common/common.css?v=3" rel="stylesheet">
  <link href="/static/chat/chat.css?v=5" rel="stylesheet">
  <link href="/static/common/toast.css" rel="stylesheet">
</head>

<body class="min-h-screen flex flex-col" style="background-color: var(--bg);">
  <div id="toast-container" class="toast-container"></div>

  <header class="border-b border-[var(--border)] bg-[var(--bg)]/80 backdrop-blur-md sticky top-0 z-10">
    <div class="chat-public-header max-w-5xl mx-auto px-6 h-14 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="font-semibold tracking-tight">Grok2API</div>
        <div class="text-xs text-[var(--accents-5)]">在线聊天</div>
      </div>
      <div class="chat-top-actions flex items-center gap-2">
        <a href="/login" class="geist-button-outline text-xs px-3 py-1.5">后台登录</a>
        <a href="/admin/chat" class="geist-button-outline text-xs px-3 py-1.5">后台聊天</a>
      </div>
    </div>
  </header>

  <main class="flex-1 container mx-auto max-w-5xl px-6 py-6 fade-in space-y-4">
    <div class="config-card">
      <div class="config-header">
        <div class="config-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
        </div>
        <div class="config-title-group">
          <div class="config-title">连接配置</div>
          <div class="config-subtitle">配置 API 密钥和模型参数</div>
        </div>
      </div>
      
      <div class="config-body">
        <div class="config-grid">
          <!-- API Key 输入区域 -->
          <div class="config-field config-field-api">
            <div class="field-header">
              <label class="field-label-modern" for="api-key-input">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
                </svg>
                API Key（Bearer）
              </label>
            </div>
            <div class="input-wrapper">
              <input id="api-key-input" type="password" class="config-input font-mono" placeholder="sk-... 或你自定义的 Key" />
              <button type="button" class="input-addon" onclick="togglePasswordVisibility()" title="显示/隐藏密钥">
                <svg id="eye-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </button>
            </div>
            <div class="field-hint">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
              </svg>
              后台入口会尝试读取"配置管理 → API 密钥"自动填充。
            </div>
          </div>
          
          <!-- 模型选择区域 -->
          <div class="config-field config-field-model">
            <div class="field-header">
              <label class="field-label-modern" for="model-select">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                  <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                </svg>
                模型
              </label>
            </div>
            <select id="model-select" class="config-select"></select>
          </div>
          
          <!-- Stream 开关区域 -->
          <div class="config-field config-field-stream">
            <label class="stream-toggle-wrapper" for="stream-toggle">
              <div class="stream-toggle-track">
                <input id="stream-toggle" type="checkbox" class="stream-checkbox" checked>
                <div class="stream-toggle-thumb"></div>
              </div>
              <div class="stream-label-group">
                <span class="stream-label">Stream</span>
                <span class="stream-desc">流式响应</span>
              </div>
            </label>
          </div>
        </div>
        
        <!-- 操作按钮区域 -->
        <div class="config-actions">
          <button class="config-btn config-btn-save" onclick="saveApiKey()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            保存配置
          </button>
          <button class="config-btn config-btn-clear" onclick="clearApiKey()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            清除
          </button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="tabs">
        <button id="tab-chat" class="tab active" onclick="switchTab('chat')">聊天</button>
        <button id="tab-image" class="tab" onclick="switchTab('image')">生图</button>
        <button id="tab-video" class="tab" onclick="switchTab('video')">生成视频</button>
      </div>

      <div id="panel-chat" class="panel">
        <div id="chat-messages" class="chat-messages">
          <div class="empty-state">
            <div class="empty-state-icon">💬</div>
            <div class="empty-state-text">
              开始与 Grok 聊天吧！<br>
              输入消息并点击发送
            </div>
          </div>
        </div>

        <div class="composer">
          <div class="composer-row">
            <input id="chat-file" type="file" accept="image/*" class="hidden" />
            <button class="geist-button-outline text-xs px-3" onclick="pickChatImage()">上传图片</button>
            <div id="chat-attach-info" class="text-xs text-[var(--accents-5)]"></div>
            <div class="flex-1"></div>
            <button class="geist-button text-xs px-4 composer-primary" onclick="sendChat()">发送</button>
          </div>
          <textarea id="chat-input" class="geist-input h-24" placeholder="输入消息..."></textarea>
          <div id="chat-attach-preview" class="attach-preview hidden"></div>
        </div>
      </div>

      <div id="panel-image" class="panel hidden">
        <div id="image-mode-hint" class="image-mode-hint hidden">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
          当前为新生图方式：支持实时瀑布流、宽高比与并发数量。
        </div>
        
        <div id="image-run-mode-wrap" class="image-run-mode-wrap hidden">
          <div class="image-field">
            <label class="image-field-label" for="image-run-mode">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
              </svg>
              运行模式
            </label>
            <select id="image-run-mode" class="image-select">
              <option value="single">single（单次）</option>
              <option value="continuous">continuous（持续）</option>
            </select>
          </div>
        </div>
        
        <!-- 生图表单区域 -->
        <div class="image-form">
          <!-- Prompt 输入区 -->
          <div class="image-prompt-section">
            <label class="image-field-label" for="image-prompt">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                <path d="M2 2l7.586 7.586"></path>
                <circle cx="11" cy="11" r="2"></circle>
              </svg>
              Prompt
            </label>
            <div class="image-prompt-wrapper">
              <textarea id="image-prompt" class="image-textarea" placeholder="✨ 描述你要生成的图片，越详细效果越好..."></textarea>
              <div class="prompt-tips">
                <span class="tip-item">💡 提示：添加风格词如 "cinematic"、"watercolor" 等获得更好效果</span>
              </div>
            </div>
          </div>
          
          <!-- 参数设置区 -->
          <div class="image-params-section">
            <div class="image-param-group">
              <div id="image-n-wrap" class="image-field">
                <label class="image-field-label" for="image-n">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                  </svg>
                  数量
                </label>
                <div class="number-input-wrapper">
                  <button type="button" class="number-btn number-btn-minus" onclick="adjustImageCount(-1)">−</button>
                  <input id="image-n" type="number" class="image-number-input" min="1" max="10" value="1" />
                  <button type="button" class="number-btn number-btn-plus" onclick="adjustImageCount(1)">+</button>
                </div>
              </div>
              
              <div id="image-aspect-wrap" class="image-field hidden">
                <label class="image-field-label" for="image-aspect">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                  </svg>
                  宽高比
                </label>
                <select id="image-aspect" class="image-select">
                  <option value="2:3">📱 2:3 竖版</option>
                  <option value="1:1">⬜ 1:1 方形</option>
                  <option value="3:2">🖼️ 3:2 横版</option>
                  <option value="16:9">📺 16:9 宽屏</option>
                  <option value="9:16">📱 9:16 竖屏</option>
                </select>
              </div>
              
              <div id="image-concurrency-wrap" class="image-field hidden">
                <label class="image-field-label" for="image-concurrency">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                  </svg>
                  并发
                </label>
                <select id="image-concurrency" class="image-select">
                  <option value="1">1 线程</option>
                  <option value="2">2 线程</option>
                  <option value="3">3 线程</option>
                </select>
              </div>
            </div>
            
            <!-- 生成按钮 -->
            <div id="image-generate-wrap" class="image-generate-section">
              <button id="image-generate-btn" class="image-generate-btn" onclick="generateImage()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                </svg>
                生成图片
              </button>
            </div>
          </div>
        </div>
        <div id="image-continuous-wrap" class="mt-4 hidden">
          <div class="imagine-actions mb-3">
            <button id="image-start-btn" class="geist-button-outline text-xs px-3" onclick="startImageContinuous()">开始</button>
            <button id="image-stop-btn" class="geist-button-outline text-xs px-3" onclick="stopImageContinuous()" disabled>停止</button>
            <button id="image-clear-btn" class="geist-button-outline text-xs px-3" onclick="clearImageWaterfall()">清空</button>
          </div>
          <div class="imagine-metrics mb-3">
            <div class="imagine-metric"><span>状态</span><b id="image-status-text">未连接</b></div>
            <div class="imagine-metric"><span>图片数量</span><b id="image-count-value">0</b></div>
            <div class="imagine-metric"><span>活跃任务</span><b id="image-active-value">0</b></div>
            <div class="imagine-metric"><span>平均耗时</span><b id="image-latency-value">-</b></div>
            <div class="imagine-metric"><span>最后错误</span><b id="image-error-value">-</b></div>
          </div>
          <div id="image-empty-state" class="result-placeholder">等待开始持续生图...</div>
          <div id="image-waterfall" class="image-waterfall"></div>
        </div>
        <div id="image-results" class="results-grid mt-4"></div>
      </div>

      <div id="panel-video" class="panel hidden">
        <div class="grid grid-cols-12 gap-3 items-end">
          <div class="col-span-12 md:col-span-7">
            <label class="field-label">Prompt</label>
            <textarea id="video-prompt" class="geist-input h-24" placeholder="描述你要生成的视频..."></textarea>
          </div>
          <div class="col-span-12 md:col-span-5">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="field-label">比例</label>
                <select id="video-aspect" class="geist-input h-[34px]">
                  <option value="3:2">3:2</option>
                  <option value="16:9">16:9</option>
                  <option value="9:16">9:16</option>
                  <option value="1:1">1:1</option>
                  <option value="2:3">2:3</option>
                </select>
              </div>
              <div>
                <label class="field-label">时长（秒）</label>
                <input id="video-length" type="number" class="geist-input" min="5" max="15" value="6" />
              </div>
              <div>
                <label class="field-label">分辨率</label>
                <select id="video-resolution" class="geist-input h-[34px]">
                  <option value="SD">SD</option>
                  <option value="HD">HD</option>
                </select>
              </div>
              <div>
                <label class="field-label">预设</label>
                <select id="video-preset" class="geist-input h-[34px]">
                  <option value="custom">custom</option>
                  <option value="normal">normal</option>
                  <option value="fun">fun</option>
                  <option value="spicy">spicy</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="composer mt-4">
          <div class="composer-row">
            <input id="video-file" type="file" accept="image/*" class="hidden" />
            <button class="geist-button-outline text-xs px-3" onclick="pickVideoImage()">上传参考图（可选）</button>
            <div id="video-attach-info" class="text-xs text-[var(--accents-5)]"></div>
            <div class="flex-1"></div>
            <button class="geist-button text-xs px-4 composer-primary" onclick="generateVideo()">生成视频</button>
          </div>
          <div id="video-attach-preview" class="attach-preview hidden"></div>
        </div>

        <div id="video-results" class="mt-4"></div>
      </div>
    </div>
  </main>

  <script src="/static/common/toast.js"></script>
  <script src="/static/chat/chat.js?v=4"></script>
</body>

</html>


